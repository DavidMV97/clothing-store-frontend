<div class="product-list">
  <div class="product-header-controls">
    <div class="product-filters">
      <mat-form-field appearance="outline" style="vertical-align: top;" class="flex-1">
        <mat-label>Buscar producto</mat-label>
        <input matInput type="text" placeholder="Escribe un nombre..." (input)="onSearchChange($event.target.value)" />
      </mat-form-field>
      <mat-form-field appearance="fill" class="w-full mb-4">
        <mat-label>Filtrar por Categoría</mat-label>
        <mat-select (selectionChange)="onCategoryChange($event.value)">
          <mat-option value="">Todas</mat-option>
          <mat-option *ngFor="let category of categories$ | async" [value]="category">
            {{ category }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="add-product-button">
      <button mat-raised-button (click)="openAddProductDialog()">
        Agregar Nuevo Producto
      </button>
    </div>
  </div>


  <div class="product-item" *ngFor="let product of products$ | async; trackBy: trackById">
    <div class="product-header main-black" (click)="toggleExpand(product._id)">
      <span>ID: {{ product._id }}</span>
      <span>Categoría: {{ product.category }}</span>
      <span class="description">Descripción: {{ product.description }}</span>
      <span class="arrow" [class.expanded]="isExpanded(product._id)">▼</span>
    </div>

    <div class="product-details" *ngIf="isExpanded(product._id)">
      <div class="table-container">
        <table class="product-table">
          <thead>
            <tr>
              <th>Imagen</th>
              <th>Fecha De Creación</th>
              <th>Nombre</th>
              <th>Categoría</th>
              <th>Precio</th>
              <th>Valor</th>
              <th>Stock</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><img [src]="product.productImageUrl" [alt]="product.name" class="product-image" width="50"></td>
              <td>{{ product.creationDate | date:'dd/MM/yyyy HH:mm' }}</td>
              <td>{{ product.name }}</td>
              <td>{{ product.category }}</td>
              <td>{{ product.price | currency }}</td>
              <td>{{ product.value | currency }}</td>
              <td>{{ product.stock }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="product-actions">
        <button mat-icon-button (click)="openEditProductDialog(product)">
          <mat-icon style="color: #005CBB">edit</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="openDeleteProductDialog(product)">
          <mat-icon style="color: #ba1a1a;">delete</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Controles de paginación -->
  <div class="pagination-controls" *ngIf="pagination">
    <div class="pagination-info">
      Página {{ pagination.currentPage }} de {{ pagination.totalPages }}
      ({{ pagination.totalItems }} productos en total)
    </div>
    <div class="pagination-buttons">
      <button [disabled]="!canGoPrevious" (click)="previousPage()" class="pagination-button">
        Anterior
      </button>
      <button [disabled]="!canGoNext" (click)="nextPage()" class="pagination-button">
        Siguiente
      </button>
    </div>
  </div>
</div>